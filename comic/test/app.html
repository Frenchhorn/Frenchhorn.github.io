<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="css/bootstrap.css">
    <script type="text/javascript" src="js/vue.js"></script>
    <script type="text/javascript" src="js/jquery.min.js"></script>
    <script type="text/javascript" src="index.js"></script>

    <script>
        var source = {};
        var searchWord = '';
    </script>
    <script type="text/javascript" src="source/kosuzu.js"></script>
</head>

<body>
    <div class="container">
        <div class="row" id="searchBar" v-if="seen">
            <div class="col-md-10 col-md-offset-1 jumbotron text-center">
                <h1 class="hidden-xs">漫画搜索</h1>
                <div class="input-group">
                    <span class="input-group-addon" style="cursor:pointer" onselectstart="return false" v-on:click="changeSearchType">{{ searchArgs.searchType }}</span>
                    <input v-on:keyup="search" v-model="value" type="text" required="" placeholder="请输入搜索关键字" class="form-control input-lg">
                </div>
            </div>
        </div>
        <div class="row" id="searchResult" v-if="seen">
            <div class="col-md-10 col-md-offset-1">
                <div class="panel panel-default" v-for="item in index" style="display: none;" v-bind:number="item.number" v-bind:comic="item.comic" v-bind:author="item.author" v-bind:contributor="item.contributor">
                    <div class="panel-heading">
                        <h3 class="panel-title">{{ item.comic }}</h3>
                    </div>
                    <div class="panel-body">
                        作者：{{ item.author }}<br>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
<script>
    var searchBar = new Vue({
        el: '#searchBar',
        data: {
            seen: true,
            value: '',
            searchArgs: {
                pattern: /[`~\!@$%\^&\*\(\)\-\+\=\{\}\[\]\\\|;\:'",<\.>\/\? ]/g,
                finish: true,
                over500ms: true,
                temp: {word: '', type: ''},
                searchTypeList: ['全部', '名称', '作者', '编号'],
                searchType: '全部',
            },
        },
        methods: {
            search: function(){
                if (!this.searchArgs.finish || !this.searchArgs.over500ms){
                    return false
                }
                this.searchArgs.finish = false
                this.searchArgs.over500ms = false
                setTimeout("searchBar.over500ms()", 500)
                this.searchArgs.temp['word'] = this.value
                this.searchArgs.temp['type'] = this.searchArgs.searchType
                $('#searchResult [comic]').hide()
                var value = this.value.replace(this.searchArgs.pattern, '')
                if (value){
                    if (this.searchArgs.searchType === '全部' || this.searchArgs.searchType === '名称'){
                        $('#searchResult [comic*=' + value + ']').show()
                    }
                    if (this.searchArgs.searchType === '全部' || this.searchArgs.searchType === '作者'){
                        $('#searchResult [author*=' + value + ']').show()
                    }
                    if (this.searchArgs.searchType === '全部' || this.searchArgs.searchType === '编号'){
                        $('#searchResult [number=' + value + ']').show()
                    }
                    //$('#searchResult [contributor*=' + value + ']').show()
                }
                this.searchArgs.finish = true
                if (this.searchArgs.over500ms && (this.searchArgs.temp['word'] !== this.value || this.searchArgs.temp['type'] !== this.searchArgs.searchType)){
                    this.search()
                }
            },
            over500ms: function(){
                this.searchArgs.over500ms = true
                if (this.searchArgs.finish && (this.searchArgs.temp['word'] !== this.value || this.searchArgs.temp['type'] !== this.searchArgs.searchType)){
                    this.search()
                }
            },
            changeSearchType: function(){
                var index = this.searchArgs.searchTypeList.indexOf(this.searchArgs.searchType)
                if (index+1 !== this.searchArgs.searchTypeList.length){
                    this.searchArgs.searchType = this.searchArgs.searchTypeList[index+1]
                }else{
                    this.searchArgs.searchType = this.searchArgs.searchTypeList[0]
                }
                this.search()
            },
        }
    })

    var searchResult = new Vue({
        el: '#searchResult',
        data: {
            seen: true,
            index: index
        },
        methods: {
        },
    })

</script>
</html>